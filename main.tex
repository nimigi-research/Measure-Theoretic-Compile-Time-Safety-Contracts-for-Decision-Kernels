% =====================================================================
% Measure-Theoretic Compile-Time Safety Contracts for Decision Kernels
% and an Ergodic “Murphy Clock”
% Monolithic main.tex (full replacement)
% =====================================================================
\documentclass[11pt]{article}

% -------------------- Encoding & Geometry --------------------
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[margin=1in]{geometry}
\usepackage{microtype}

% -------------------- Math & Theorems --------------------
\usepackage{amsmath,amssymb,amsthm,mathtools}
\usepackage{bbm}
\usepackage{enumitem}

% -------------------- Hyperrefs & Cleveref --------------------
\usepackage{hyperref}
\usepackage[nameinlink,noabbrev]{cleveref}

\hypersetup{
  colorlinks=true,
  linkcolor=blue!50!black,
  citecolor=green!40!black,
  urlcolor=magenta!50!black
}

% -------------------- Bibliography (biblatex/biber) --------------------
\usepackage[backend=biber,style=authoryear,maxcitenames=2,maxbibnames=9,doi=false,isbn=false,url=false]{biblatex}
\addbibresource{refs.bib} % global unified bibliography

% -------------------- Environments & Macros --------------------
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}

\newcommand{\E}{\mathbb{E}}
\newcommand{\Prob}{\mathbb{P}}
\newcommand{\1}{\mathbbm{1}}
\newcommand{\KL}{\mathrm{KL}}
\newcommand{\TV}{\mathrm{TV}}
\newcommand{\mix}{\mathrm{mix}}

\newcommand{\F}{\mathcal{F}}
\newcommand{\A}{\mathcal{A}}
\newcommand{\Y}{\mathcal{Y}}
\newcommand{\B}{\mathcal{B}}
\newcommand{\K}{\mathcal{K}}
\newcommand{\Pcal}{\mathcal{P}}

\title{\vspace{-0.5em}Measure-Theoretic Compile-Time Safety Contracts for Decision Kernels\\
and an Ergodic ``Murphy Clock''}
\author{Jacob Elliott}
\date{\today}

% =====================================================================
\begin{document}
\maketitle

\begin{abstract}
We formalize \emph{compile-time} safety for stochastic decision systems as a family of \(\sigma\)-measurable contracts on Markov kernels and policies, and prove that these contracts are \emph{closed} under standard constructions (mixture, composition, product, and measurable pushforward). In the finite-state specialization the contracts reduce to forward-closed sets under allowed edges and can be verified with linear-time graph traversals. We additionally introduce \emph{soft} contracts that allow controlled violation envelopes parameterized by information prices and risk—leading to quantitative guarantees on failure horizons.

Complementing design-time invariants, we derive an \emph{ergodic Murphy clock}: a finite-time discovery schedule ensuring that if a safe (or hazardous) configuration \emph{can} be reached under the admissible policy class, then—under standard minorization or total-variation mixing hypotheses—it will be reached \emph{on schedule} with high probability. The schedule is calibrated by a spectral–large deviation layer on quotients, producing explicit critical horizons \(L_c\sim \log(1/\beta)/(\alpha I(\theta))\) where \(\alpha\) is an information price, \(\beta\) a failure probability, and \(I\) a convex rate function obtained from tilted spectral radii \parencite{DemboZeitouni1998,elliott2025qfi}. The approach interoperates with Blackwell sufficiency and FI/CRLB transport across idioms \parencite{Blackwell1953,AmariNagaoka2000,Cencov1982,elliott2025idiom}, with ergodic drift guarantees \parencite{MeynTweedie2009,KochenStone1964,Freedman1975,elliott2025drift}, and with Flow Centrality for route diagnostics \parencite{elliott2025flow,Freeman1977,Newman2005}.
\end{abstract}

\section{Introduction}
Run-time enforcement of safety in stochastic decision systems is brittle if not anchored in the \emph{measurability and support} structure of the underlying kernels and policies. This paper packages safety as \(\sigma\)-contracts that live at the type/interface boundary of Markov decision kernels and are \emph{checked at compile time}. The contracts ensure (i) that safe sets are measurable, (ii) that action admissibility is measurable and support-respecting, and (iii) that the controlled kernel never leaks probability mass into hazards under allowed actions. These are classical measure-theoretic concerns, rendered as explicit interface invariants \parencite[Chs.~1--4]{Bogachev2007,AliprantisBorder2006}.

We prove that \(\sigma\)-contracts are preserved under mixtures, compositions, and measurable pushforwards (so pipelines remain safe), and we give a finite-state specialization where the checks reduce to forward-closure under allowed edges and can be implemented via BFS/DFS in linear time \parencite[Ch.~22]{Cormen2009}. We then move beyond hard constraints: \emph{soft contracts} introduce a controlled slack envelope, parameterized by an information price \(\alpha\) and risk parameters that translate to quantitative failure bounds.

Finally, we couple these design-time contracts to a \emph{Murphy clock}: if a configuration can happen in an ergodic system, then the clock gives finite-time, high-probability guarantees that it will happen on schedule. The analysis proceeds via (i) Doeblin/minorization to obtain block-geometric tails \parencite[Chs.~15--16]{MeynTweedie2009} or (ii) total-variation mixing at a task scale \(\approx h/2\) \parencite{LevinPeresWilmer2009}; in both cases, the schedule tightens using spectral tilts and rate functions on quotients \parencite{DemboZeitouni1998,elliott2025qfi}. The result integrates cleanly with FI/CRLB transport \parencite{Blackwell1953,AmariNagaoka2000,Cencov1982,elliott2025idiom} and Flow Centrality instrumentation \parencite{elliott2025flow,Freeman1977,Newman2005}.

\paragraph{Contributions.}
\begin{enumerate}[leftmargin=1.35em]
\item \textbf{Contract language.} A measure-theoretic interface for safety of Markov decision kernels and policies; closure under mixture/composition/pushforward and a finite-state reduction to forward-closed sets (BFS/DFS check) \parencite{Bogachev2007,Cormen2009}.
\item \textbf{Soft contracts.} Risk-indexed envelopes that upper-bound failure horizons via convex duals of tilted spectral radii on quotient flows \parencite{DemboZeitouni1998,elliott2025qfi}.
\item \textbf{Murphy clock.} Block-geometric and TV-mixing derivations that yield explicit high-probability discovery schedules; aggregation to quotients preserves guarantees up to gap-damped error terms \parencite{MeynTweedie2009,LevinPeresWilmer2009,elliott2025qfi}.
\item \textbf{Interop.} Seamless alignment with FI/CRLB transport and sufficiency \parencite{Blackwell1953,AmariNagaoka2000,Cencov1982,elliott2025idiom}, with drift-validity coverage \parencite{elliott2025drift,KochenStone1964,Freedman1975}, and with Flow Centrality diagnostics \parencite{elliott2025flow}.
\end{enumerate}

\section{Preliminaries}
\paragraph{Spaces.}
Let \((\Omega,\F)\) be a standard Borel space, \((\A,\mathcal{A})\) a Borel action space, and \((\Y,\mathcal{Y})\) an observation space. Standard Borel structure ensures regular conditional probabilities and measurable selection \parencite[Chs.~7--9]{Bogachev2007,AliprantisBorder2006}.

\paragraph{Kernels and policies.}
A (controlled) Markov kernel is a measurable map \(K:\Omega\times \A\to \Pcal(\Omega)\) such that \(a\mapsto K(\omega,a;B)\) is measurable for each \(B\in\F\) and \(\omega\mapsto K(\omega,a;B)\) is measurable for each \(a\); a policy \(\pi:\Omega\to \Pcal(\A)\) is measurable with \(\supp(\pi(\cdot\mid \omega))\subseteq \A\) \parencite[Chs.~1--2]{MeynTweedie2009}. The one-step controlled kernel is
\[
P_\pi(\omega,\cdot)=\int_{\A}K(\omega,a;\cdot)\,\pi(\omega,da).
\]

\paragraph{Allowed actions and safe sets.}
Let \(S\in\F\) be the \emph{safe set} and \(H:=S^c\) the hazard set. A measurable set-valued map \(A_{\mathrm{safe}}:\Omega\rightrightarrows\A\) assigns allowed actions; measurability means \(\{(\omega,a):a\in A_{\mathrm{safe}}(\omega)\}\in \F\otimes\mathcal{A}\) \parencite{AliprantisBorder2006}.

\section{\texorpdfstring{$\sigma$}{sigma}-Safety Contracts}\label{sec:sigma}
\begin{definition}[Safety tiers]
Let \(\K\) be a family of kernels. For each \(\omega\in S\):
\begin{itemize}[leftmargin=1.3em]
\item \textbf{Robust-\(\sigma\)} (R-\(\sigma\)): \(\forall K\in\K,\ \forall a\in \A:\ K(\omega,a;H)=0\).
\item \textbf{Interface-\(\sigma\)} (I-\(\sigma\)): \(\forall K\in\K,\ \forall a\in A_{\mathrm{safe}}(\omega):\ K(\omega,a;H)=0\).
\item \textbf{Policy-\(\sigma\)} (P-\(\sigma\)) for \(\pi\): \(\forall a\in\supp(\pi(\cdot\mid \omega)):\ K(\omega,a;H)=0\).
\end{itemize}
Then \(\text{R-}\sigma\Rightarrow\text{I-}\sigma\Rightarrow\text{P-}\sigma\).
\end{definition}

\paragraph{Closure.}
If \(K_1,K_2\) satisfy I-\(\sigma\), then any measurable mixture \(K=\lambda K_1+(1-\lambda)K_2\) satisfies I-\(\sigma\); likewise, composition and measurable pushforward preserve the property. Proofs are by linearity/monotonicity of measures and measurability of composition/pushforward \parencite[Chs.~1--2]{Bogachev2007}.

\paragraph{Typed interfaces.}
Each contract is an interface predicate attached to a kernel/policy, checked by a static analyzer that enforces: (i) set measurability, (ii) non-leakage \(K(\cdot,\cdot;H)=0\) on the allowed support, (iii) closure rules under constructors. See \parencite{elliott2025contracts,elliott2025graded} for typed/graded effect systems reflecting these constraints.

\subsection{Continuous-time (point-process) variant}\label{sec:ct}
For point-process dynamics with hazard intensity \(\lambda_H(\omega,a)\), the contract reads \(\lambda_H(\omega,a)=0\) on the allowed support. Under time-discretization with step \(\Delta t\), this reduces to the discrete-time I-\(\sigma\) condition up to \(O(\Delta t)\) errors. Standard thinning and compensator arguments ensure measurability and inheritance under composition \parencite[§3.2]{MeynTweedie2009}.

\section{Finite-state specialization and graph checks}\label{sec:finite}
On a finite state space, define allowed edge set
\[
E=\{(i,j):\exists a\in A_{\mathrm{safe}}(i)\ \text{with}\ K(i,a;\{j\})>0\}.
\]
I-\(\sigma\) reduces to: for all \(i\in S\), every path in the graph \((\Omega,E)\) that starts in \(i\) remains in \(S\). This is equivalent to \(S\) being \emph{forward-closed}. It can be verified in \(O(|\Omega|+|E|)\) time by BFS/DFS \parencite[Ch.~22]{Cormen2009}. For policy-specific P-\(\sigma\), restrict to edges supported by \(\pi\).

\section{Soft contracts and horizon failure envelopes}\label{sec:soft}
Soft contracts allow a controlled envelope: for an event \(\mathcal{E}_T\) (e.g., “enter \(H\) by time \(T\)”), bound
\[
\Prob(\mathcal{E}_T)\ \le\ \exp\{-\alpha\, I(\theta)\, T\} + \varepsilon_{\mathrm{lump}}/\gamma,
\]
where \(I(\theta)\) is a convex rate obtained by Legendre dual of a tilted spectral radius on the quotient, \(\varepsilon_{\mathrm{lump}}\) a lumpability dispersion, and \(\gamma\) a spectral gap \parencite{DemboZeitouni1998,elliott2025qfi}. The envelope calibrates risk–price tradeoffs; CVaR/utility-style softening can also be layered here \parencite{RockafellarUryasev2000}.

\section{Ergodic Murphy scaling for rare-event search}\label{sec:murphy}
The Murphy clock gives finite-time schedules that turn existential reachability (“it can happen”) into high-probability guarantees (“it will happen on schedule”):
\[
L_c(\theta;\alpha,\beta)\ \approx\ \frac{\log(1/\beta)}{\alpha\, I(\theta)}.
\]
We present two derivations.

\subsection{Version A: minorization (block-geometric tails)}\label{sec:minor}
Assume a Doeblin condition: there exist \(h\in\mathbb{N}\), \(\epsilon>0\), and a measure \(\nu\) such that \(P_\pi^h(\omega,\cdot)\ge \epsilon\,\nu(\cdot)\) for all \(\omega\) \parencite[Ch.~16]{MeynTweedie2009}. Then block hits of a measurable target set \(S\) are i.i.d.\ with success probability \(\ge \epsilon\,\nu(S)\), yielding geometric tails and a schedule with failure \(\le (1-\epsilon\,\nu(S))^{\lfloor T/h\rfloor}\). Aggregation to quotients preserves the bound up to gap-damped error \(\varepsilon_{\mathrm{lump}}/\gamma\) \parencite{elliott2025qfi}.

\subsection{Version B: TV-mixing at the \texorpdfstring{$h/2$}{h/2} scale}\label{sec:mix}
If \(\|P_\pi^t(\omega,\cdot)-\eta\|_{\TV}\le \delta(t)\) for a stationary \(\eta\), then after \(t\ge \mix(\epsilon)\) we have occupancy near \(\eta\). For any \(S\), the chance of not visiting \(S\) by time \(t\) decays as \(\approx \exp\{-t\,I(\eta(S))\}\) after a mixing window; explicit constants follow from coupling/spectral methods \parencite[Chs.~4--12]{LevinPeresWilmer2009}. The spectral–LDP representation makes \(I\) computable via tilts on the quotient \parencite{DemboZeitouni1998,elliott2025qfi}.

\section{Case studies: BA--FRC and a neutral baseline}\label{sec:cases}
\subsection{BA--FRC contracts (interface-\texorpdfstring{$\sigma$}{sigma})}
In the \emph{Bad Apples—First Rate Chaps} (BA--FRC) toy environment \parencite{elliott2025bafrc}, interface-\(\sigma\) contracts exclude hazard actions at the role boundary. The Murphy clock predicts time-to-detection for compromised routes; Flow Centrality’s action–betweenness spikes corroborate the fragile edges \parencite{elliott2025flow,Freeman1977,Newman2005}.

\subsection{Neutral baseline: lazy expander walk}
On a lazy expander (spectral gap \(\gamma\approx 1-\lambda_2>0\)), forward-closed safe sets remain invariant under allowed moves; mixing-time control yields sharp occupancy bounds and near-optimal Murphy schedules. See \parencite{HooryLinialWigderson2006,LevinPeresWilmer2009}.

\section{Static analyzers and implementation notes}\label{sec:impl}
A lightweight analyzer checks: (i) measurability of \(S\) and \(A_{\mathrm{safe}}\); (ii) support constraints \(\supp(\pi)\subseteq A_{\mathrm{safe}}\); (iii) closure rules under kernel constructors; (iv) forward-closure by BFS/DFS in the finite-state case \parencite{Cormen2009}. In constrained MDP pipelines, admissibility is propagated through options/skills with guarantees preserved \parencite{Puterman1994,Altman1999}. Idiom projections that are sufficient preserve FI exactly; otherwise CRLB widens—useful for flagging lossy coarse-grainings \parencite{Blackwell1953,AmariNagaoka2000,Cencov1982,elliott2025idiom}.

\section{Experiments}\label{sec:exp}
We instantiate I-\(\sigma\) contracts in two synthetic tasks (BA--FRC, lazy expander). For each, we:
\begin{enumerate}[leftmargin=1.3em]
\item verify forward-closure (BFS/DFS);
\item estimate \(\Lambda(t)=\log\rho(\mathrm{diag}(e^{t\cdot \1_S})P)\) on the quotient and compute \(I(\theta)=\sup_t\{t\theta-\Lambda(t)\}\);
\item produce Murphy plots \(L_c(\theta;\alpha,\beta)\);
\item overlay Flow Centrality and action–betweenness to localize fragile channels.
\end{enumerate}
Measured latencies align with the predicted \(L_c\) curves to within constant factors; departures occur only when lumpability error approaches the spectral gap (\(\varepsilon_{\mathrm{lump}}\approx \gamma\)) \parencite{elliott2025qfi}.

\section{Discussion and limitations}\label{sec:disc}
Limits include: (i) high lumpability error swamping the gap; (ii) no sufficient projections for FI transport (strict information loss across idioms); (iii) failure of small-ball or mixing hypotheses under heavy-tailed or adversarial drift. These are diagnosable by the same stack: unstable tilts (spectral), curvature loss (FI/CRLB), and alarmed drift floors \parencite{elliott2025qfi,elliott2025idiom,elliott2025drift}.

\section{Conclusion}\label{sec:conc}
\(\sigma\)-contracts make safety \emph{static} and compositional; the Murphy clock makes safety \emph{operational} at finite time. Together they furnish a compile-time/run-time handshake for robust stochastic decision pipelines, integrated with information geometry, ergodic theory, and graph diagnostics.

% ============================== Proofs ==============================
\section{Proof details}\label{sec:proofs}

\subsection*{Composition measurability}
Let \(K_1,K_2\) be I-\(\sigma\). For any measurable \(B\subseteq H\) and allowed action \(a\in A_{\mathrm{safe}}(\omega)\),
\[
\int K_2(\omega',a';B)\,K_1(\omega,a;d\omega')=0,
\]
since the integrand is a.e.\ zero by I-\(\sigma\) and measurability allows Fubini/Tonelli interchanges \parencite[Ch.~1]{Bogachev2007}. Measurable pushforwards preserve zero mass on hazards by naturality of image measures.

\subsection*{Block-geometric bound (minorization)}\label{thm:murphyA}
Under minorization \(P_\pi^h\ge \epsilon\nu\), let \(Z_k:=\1\{X_{kh}\in S\}\). Then \(Z_k\) dominates i.i.d.\ Bernoulli\((\epsilon\nu(S))\), so
\[
\Prob(\tau_S>mh)\ \le\ (1-\epsilon\nu(S))^m,
\]
with \(\tau_S\) the first \(S\)-hit. Choosing \(m=\lceil \log(1/\beta)/\log(1/(1-\epsilon\nu(S)))\rceil\) yields the guarantee; quotient aggregation perturbs constants by \(O(\varepsilon_{\mathrm{lump}}/\gamma)\) \parencite{MeynTweedie2009,elliott2025qfi}.

\subsection*{TV-mixing bound}\label{thm:murphyB}
If \(\|P_\pi^t(\omega,\cdot)-\eta\|_{\TV}\le \delta(t)\), then for any \(S\),
\[
\Prob_\omega(X_t\in S)\ \ge\ \eta(S)-\delta(t).
\]
Chernoff bounds with the spectral CGF \(\Lambda(t)\) on the quotient yield
\[
\Prob\Big(\frac{1}{T}\sum_{t=0}^{T-1}\1\{X_t\in S\}<\theta\Big)\ \lesssim\ \exp\{-T\,I(\theta)\},
\]
with \(I\) the Legendre dual of \(\Lambda\) \parencite{LevinPeresWilmer2009,DemboZeitouni1998}. Selecting \(\theta=\eta(S)-\epsilon\) gives the Murphy horizon formula.

% ============================= Appendix ============================
\section{Finite-state BFS pseudocode}\label{sec:bfs}
Given \(S\subset \Omega\) and allowed edges \(E=\{(i,j): \sup_{a\in A_{\mathrm{safe}}(i)} K(i,a;\{j\})>0\}\):
\begin{quote}\small
\textbf{Input:} graph \(G=(\Omega,E)\), safe set \(S\). \\
\textbf{Initialize:} queue \(\leftarrow\) all \(i\in S\); visited \(\leftarrow S\). \\
\textbf{While} queue nonempty: pop \(u\); \textbf{for each} edge \((u,v)\in E\): \\
\quad \textbf{if} \(v\notin\) visited \textbf{then} add \(v\) to visited and queue; \\
\quad \textbf{if} \(v\in S^c\) \textbf{then fail (not forward-closed)}. \\
\textbf{If} loop completes without failure: \textbf{pass (forward-closed)}.
\end{quote}
This is \(O(|\Omega|+|E|)\) and certifies I-\(\sigma\) (or P-\(\sigma\) if \(E\) is restricted by \(\pi\)) \parencite[Ch.~22]{Cormen2009}.
\vspace{0.5em}

\printbibliography

\end{document}